<!doctype html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>SFCC search</title>
	<script>
		async function getData() {
			const response = await fetch('https://salesforcecommercecloud.github.io/b2c-dev-doc/search.json');
			const data = await response.json();
			return data;
		}

		var data = getData();
		var ret;
		data.then(result => ret = result)

		function formatPage(page, val) {
			// let bval = '<b>' + val + '</b>'
			let {url, title, content} = page;
			// title = title.replaceAll(val,bval);
			if (page.title.indexOf('Class ') === 0){
				content = content.substring(content.search(/(dw(\.\w{1,30}){2,}\s)+/), content.search(/\s(Properties|Constants)\s/)).replaceAll(/dw(\.\w+)+\s/g,'');
			}
			let html = '<div id="resultBlock"><a href="https://salesforcecommercecloud.github.io' + page.url + '" target="_blank"><span style="link-font">'+title+'</span></a>'+
				'<br><p>' + content.substring(0,350) + (content.length >= 350 ? '...' : '') + '</p><br></div>';
			return html;
		}

		function searchList() {
			var val = document.getElementById('searchTerm').value;
			var sval = document.getElementById('searchTerm').value.toUpperCase();
			if(val.length === 0) return;
			var results = 
				ret.filter(page => Object.keys(page).length &&
					(page.content?.toUpperCase().indexOf(sval) !== -1 || page.title?.toUpperCase().indexOf(sval) !== -1) && 
					page.url?.indexOf('/upcoming/') !== -1 && 
					page.title?.indexOf('Server-side javascript') === -1)
				.map(page => formatPage(page, val)).join('');
			document.getElementById('searchResult').innerHTML = results;
		}
	</script>
	<style>
		.c-margin-top-bottom {
			margin-top: 30px;
			margin-bottom: 30px;
		}
		.c-center {
			display: flex;
			align-items: center;
			justify-content: center;
		}
		.c-search-input {
			margin-right:10px;
			width: 20%;
		}
		.c-border-radius {
			border-radius: 10px;
		}
		#resultBlock {
			width:70%;
			margin: auto;
		}
		a {
			font-size: 20px;
		}
		body {
			background-color: #bbb;
		}
	</style>
</head>
<body>
	<div class="c-center c-margin-top-bottom">
		<input type="text" id="searchTerm" class="c-border-radius c-search-input"/>
		<button id="btn" class="border-radius">Search</button>
	</div>
	<div id="searchResult" class="c-content-center">

	</div>
	<script>
		let btn = document.getElementById('btn');
		btn.addEventListener('click', (ev)=>{
			searchList();
		});
		document.addEventListener('keypress', (event) => {
			let keyCode = event.keyCode ? event.keyCode : event.which;
			if(keyCode === 13) {
				btn.click();
			}
		});
		let inputElem = document.querySelector("#searchTerm");
		window.addEventListener('load', function(e) {
			inputElem.focus();
		})
	</script>
</body>
</html>
